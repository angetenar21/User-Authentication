<h2>Add New Task</h2>
<form action="/addTask" method="post">
  <input type="text" name="title" placeholder="Title" required>
  <input type="text" name="description" placeholder="Description">
  <button type="submit">Add Task</button>
</form>

<hr>

<h2>Your Tasks</h2>
<% if (tasks && tasks.length > 0) { %>
  <div class="tasks-list">
    <% tasks.forEach(function(task) { %>
      <div class="task-item">
        <h3><%= task.title %></h3>
        <p><%= task.description %></p>
        <span class="status <%= task.status %>">Status: <%= task.status %></span>
        <small>Created: <%= task.createdAt.toDateString() %></small>
        
        <div class="task-actions">
          <select onchange="updateTaskStatus('<%= task._id %>', this.value)">
            <option value="pending" <%= task.status === 'pending' ? 'selected' : '' %>>Pending</option>
            <option value="in_progress" <%= task.status === 'in_progress' ? 'selected' : '' %>>In Progress</option>
            <option value="completed" <%= task.status === 'completed' ? 'selected' : '' %>>Completed</option>
          </select>
          <button onclick="deleteTask('<%= task._id %>')" class="delete-btn">Delete</button>
        </div>
      </div>
    <% }); %>
  </div>
<% } else { %>
  <p>No tasks yet. Create your first task above!</p>
<% } %>

<script>
async function deleteTask(taskId) {
  if (confirm('Are you sure you want to delete this task?')) {
    try {
      const response = await fetch(`/task/${taskId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        location.reload(); // Refresh the page to show updated list
      } else {
        alert('Failed to delete task');
      }
    } catch (error) {
      alert('Error deleting task');
    }
  }
}

async function updateTaskStatus(taskId, status) {
  try {
    const response = await fetch(`/task/${taskId}/status`, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ status })
    });
    
    if (response.ok) {
      location.reload(); // Refresh the page to show updated status
    } else {
      alert('Failed to update task status');
    }
  } catch (error) {
    alert('Error updating task status');
  }
}
</script>